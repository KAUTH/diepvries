INSERT INTO dv.h_customer (h_customer_hashkey, r_timestamp,r_source,customer_id) SELECT h_customer_test_role_playing_hashkey, MIN(r_timestamp) AS r_timestamp,MIN(r_source) AS r_source,MIN(customer_test_role_playing_id) AS customer_test_role_playing_id FROM dv_stg.orders_20190806_000000 AS staging WHERE NOT EXISTS(SELECT 1 FROM dv.h_customer AS hub WHERE hub.customer_id = staging.customer_test_role_playing_id) GROUP BY h_customer_test_role_playing_hashkey
