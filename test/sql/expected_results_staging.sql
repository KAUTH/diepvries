CREATE OR REPLACE TABLE dv_stg.orders_20190806_000000 (h_customer_hashkey text NOT NULL, r_timestamp timestamp_ntz NOT NULL, r_source text NOT NULL, customer_id text NOT NULL, h_order_hashkey text NOT NULL, order_id text NOT NULL, l_order_customer_hashkey text NOT NULL, ck_test_string text NOT NULL, ck_test_timestamp timestamp_ntz NOT NULL, hs_customer_hashdiff text NOT NULL, test_string text , test_date date , test_timestamp timestamp_ntz , test_integer number , test_decimal number , ls_order_customer_eff_hashdiff text NOT NULL, dummy_descriptive_field text NOT NULL) AS SELECT MD5(COALESCE(customer_id, 'dv_unknown')) AS h_customer_hashkey, CAST('2019-08-06T00:00:00.000000Z' AS TIMESTAMP) AS r_timestamp, 'test' AS r_source, COALESCE(customer_id, 'dv_unknown') AS customer_id, MD5(COALESCE(order_id, 'dv_unknown')) AS h_order_hashkey, COALESCE(order_id, 'dv_unknown') AS order_id, MD5(COALESCE(order_id, 'dv_unknown')||'|~~|'||COALESCE(customer_id, 'dv_unknown')||'|~~|'||COALESCE(CAST(ck_test_string AS VARCHAR), '')||'|~~|'||COALESCE(CAST(ck_test_timestamp AS VARCHAR), '')) AS l_order_customer_hashkey, ck_test_string, ck_test_timestamp, MD5(REGEXP_REPLACE(COALESCE(customer_id, 'dv_unknown')||'|~~|'||COALESCE(CAST(test_string AS VARCHAR), '')||'|~~|'||COALESCE(CAST(test_date AS VARCHAR), '')||'|~~|'||COALESCE(CAST(test_timestamp AS VARCHAR), '')||'|~~|'||COALESCE(CAST(test_integer AS VARCHAR), '')||'|~~|'||COALESCE(CAST(test_decimal AS VARCHAR), ''), '(\\|~~\\|){1,}$', '')) AS hs_customer_hashdiff, test_string, test_date, test_timestamp, test_integer, test_decimal, MD5(REGEXP_REPLACE(COALESCE(order_id, 'dv_unknown')||'|~~|'||COALESCE(customer_id, 'dv_unknown')||'|~~|'||COALESCE(CAST(ck_test_string AS VARCHAR), '')||'|~~|'||COALESCE(CAST(ck_test_timestamp AS VARCHAR), '')||'|~~|'||COALESCE(CAST(dummy_descriptive_field AS VARCHAR), ''), '(\\|~~\\|){1,}$', '')) AS ls_order_customer_eff_hashdiff, dummy_descriptive_field FROM dv_extract.extract_orders;
